{#{% extends 'base.html' %}#}
{#{% load static %}#}
{##}
{#{% block content %}#}
{#    <div class="container mx-auto p-6">#}
{#        <div class="text-center mb-8">#}
{#            <h1 class="text-4xl font-bold mb-4">Stock Code: <span id="stock_code" class="text-blue-600">{{ stock.code }}</span></h1>#}
{#        </div>#}
{##}
{#        <!-- Technical Analysis Section -->#}
{#        <div id="technical-chart" class="bg-gray-800 text-white p-6 rounded-xl shadow-lg mb-8" style="min-height: 600px;">#}
{#            <p class="text-center text-2xl text-gray-400">Loading chart...</p>#}
{#        </div>#}
{##}
{#        <div id="technical-metrics" class="bg-white p-8 rounded-xl shadow-lg mb-8">#}
{#            <h2 class="text-3xl font-bold text-gray-800 mb-6">Technical Analysis</h2>#}
{#            <div class="space-y-4 text-xl text-gray-700">#}
{#                <p>SMA 20: <span class="font-semibold text-gray-900" id="sma20">Loading...</span></p>#}
{#                <p>SMA 50: <span class="font-semibold text-gray-900" id="sma50">Loading...</span></p>#}
{#                <p>RSI: <span class="font-semibold text-gray-900" id="rsi">Loading...</span></p>#}
{#            </div>#}
{#        </div>#}
{##}
{#        <!-- Fundamental Analysis Section -->#}
{#        <div id="fundamental-metrics" class="bg-white p-8 rounded-xl shadow-lg">#}
{#            <h2 class="text-3xl font-bold text-gray-800 mb-6">Fundamental Analysis</h2>#}
{#            <div class="space-y-8">#}
{#                <div class="mb-8">#}
{#                    <h3 class="text-2xl font-semibold text-gray-800 mb-4">Turnover Trends</h3>#}
{#                    <p class="text-xl">Average Turnover: <span class="font-medium text-gray-900" id="avg-turnover">Loading...</span></p>#}
{#                    <p class="text-xl">Maximum Turnover: <span class="font-medium text-gray-900" id="max-turnover">Loading...</span></p>#}
{#                    <p class="text-xl">Minimum Turnover: <span class="font-medium text-gray-900" id="min-turnover">Loading...</span></p>#}
{#                </div>#}
{##}
{#                <div class="mb-8">#}
{#                    <h3 class="text-2xl font-semibold text-gray-800 mb-4">Volume Trends</h3>#}
{#                    <p class="text-xl">Total Volume: <span class="font-medium text-gray-900" id="total-volume">Loading...</span></p>#}
{#                    <p class="text-xl">Average Volume: <span class="font-medium text-gray-900" id="avg-volume">Loading...</span></p>#}
{#                    <p class="text-xl">Maximum Volume: <span class="font-medium text-gray-900" id="max-volume">Loading...</span></p>#}
{#                    <p class="text-xl">Minimum Volume: <span class="font-medium text-gray-900" id="min-volume">Loading...</span></p>#}
{#                </div>#}
{##}
{#                <div class="mb-8">#}
{#                    <h3 class="text-2xl font-semibold text-gray-800 mb-4">Volatility</h3>#}
{#                    <p class="text-xl">Average Volatility: <span class="font-medium text-gray-900" id="avg-volatility">Loading...</span></p>#}
{#                </div>#}
{#            </div>#}
{#        </div>#}
{#    </div>#}
{##}
{#    <script>#}
{#        document.addEventListener('DOMContentLoaded', () => {#}
{#            if (typeof Plotly === 'undefined') {#}
{#                console.error("Plotly is not loaded. Ensure the Plotly library is properly included.");#}
{#                return;#}
{#            }#}
{##}
{#            const stockCode = document.getElementById('stock_code').textContent;#}
{##}
{#            // Fetch Technical Analysis Data#}
{#            fetch(`/stocks/${stockCode}/technical-analysis/`)#}
{#                .then(response => response.json())#}
{#                .then(data => {#}
{#                    if (!data.plot) {#}
{#                        throw new Error("No plot data available.");#}
{#                    }#}
{##}
{#                    const plotData = JSON.parse(data.plot);#}
{#                    Plotly.newPlot('technical-chart', plotData.data, plotData.layout);#}
{##}
{#                    const metrics = data.analysis || {};#}
{#                    document.getElementById('technical-metrics').innerHTML = `#}
{#                        <h2 class="text-3xl font-bold text-gray-800 mb-6">Technical Analysis</h2>#}
{#                        <div class="space-y-4 text-xl text-gray-700">#}
{#                            <p>SMA 20: <span class="font-semibold text-gray-900">${metrics.trend?.sma20 || 'N/A'}</span></p>#}
{#                            <p>SMA 50: <span class="font-semibold text-gray-900">${metrics.trend?.sma50 || 'N/A'}</span></p>#}
{#                            <p>RSI: <span class="font-semibold text-gray-900">${metrics.momentum?.rsi || 'N/A'}</span></p>#}
{#                        </div>#}
{#                    `;#}
{#                })#}
{#                .catch(error => {#}
{#                    console.error("Error loading technical analysis:", error);#}
{#                    document.getElementById('technical-chart').innerHTML = `#}
{#                        <div class="alert alert-danger">#}
{#                            Error loading technical analysis: ${error.message}#}
{#                        </div>#}
{#                    `;#}
{#                });#}
{##}
{#            // Fetch Fundamental Analysis Data#}
{#fetch(`/stocks/${stockCode}/fundamental-analysis/`)#}
{#    .then(response => response.json())#}
{#    .then(data => {#}
{#        const turnoverTrends = data.turnover_trends || {};#}
{#        const volumeTrends = data.volume_trends || {};#}
{#        const volatility = data.volatility || {};#}
{##}
{#        // Display Fundamental Analysis Data#}
{#        document.getElementById('fundamental-metrics').innerHTML = `#}
{#            <h2 class="text-3xl font-bold text-gray-800 mb-6">Fundamental Analysis</h2>#}
{#            <div class="space-y-8">#}
{#                <div class="mb-8">#}
{#                    <h3 class="text-2xl font-semibold text-gray-800 mb-4">Turnover Trends</h3>#}
{#                    <p class="text-xl">Average Turnover: <span class="font-medium text-gray-900">${turnoverTrends['Average Turnover'] || 'N/A'}</span></p>#}
{#                    <p class="text-xl">Maximum Turnover: <span class="font-medium text-gray-900">${turnoverTrends['Maximum Turnover'] || 'N/A'}</span></p>#}
{#                    <p class="text-xl">Minimum Turnover: <span class="font-medium text-gray-900">${turnoverTrends['Minimum Turnover'] || 'N/A'}</span></p>#}
{#                </div>#}
{##}
{#                <div class="mb-8">#}
{#                    <h3 class="text-2xl font-semibold text-gray-800 mb-4">Volume Trends</h3>#}
{#                    <p class="text-xl">Total Volume: <span class="font-medium text-gray-900">${volumeTrends['Total Volume'] || 'N/A'}</span></p>#}
{#                    <p class="text-xl">Average Volume: <span class="font-medium text-gray-900">${volumeTrends['Average Volume'] || 'N/A'}</span></p>#}
{#                    <p class="text-xl">Maximum Volume: <span class="font-medium text-gray-900">${volumeTrends['Maximum Volume'] || 'N/A'}</span></p>#}
{#                    <p class="text-xl">Minimum Volume: <span class="font-medium text-gray-900">${volumeTrends['Minimum Volume'] || 'N/A'}</span></p>#}
{#                </div>#}
{##}
{#                <div class="mb-8">#}
{#                    <h3 class="text-2xl font-semibold text-gray-800 mb-4">Volatility</h3>#}
{#                    <p class="text-xl">Average Volatility: <span class="font-medium text-gray-900">${volatility['Average Volatility'] || 'N/A'}</span></p>#}
{#                </div>#}
{#            </div>#}
{#        `;#}
{#    })#}
{#    .catch(error => {#}
{#        console.error("Error loading fundamental analysis:", error);#}
{#        document.getElementById('fundamental-metrics').innerHTML = `#}
{#            <div class="alert alert-danger">#}
{#                Error loading fundamental analysis: ${error.message}#}
{#            </div>#}
{#        `;#}
{#    });#}
{#        });#}
{#    </script>#}
{#{% endblock %}#}


{#{% extends 'base.html' %}#}
{#{% load static %}#}
{##}
{#{% block content %}#}
{#<div class="container mx-auto p-6">#}
{#    <div class="text-center mb-8">#}
{#        <h1 class="text-4xl font-bold mb-4">Stock Code: <span id="stock_code" class="text-blue-600">{{ stock.code }}</span></h1>#}
{#    </div>#}
{##}
{#    <!-- Time Range Selection -->#}
{#    <div class="text-center mb-6">#}
{#        <div class="inline-flex space-x-4">#}
{#            <button class="time-range-btn bg-blue-500 text-white px-4 py-2 rounded-md shadow hover:bg-blue-600" data-range="1d">#}
{#                1 Day#}
{#            </button>#}
{#            <button class="time-range-btn bg-blue-500 text-white px-4 py-2 rounded-md shadow hover:bg-blue-600" data-range="1w">#}
{#                1 Week#}
{#            </button>#}
{#            <button class="time-range-btn bg-blue-500 text-white px-4 py-2 rounded-md shadow hover:bg-blue-600" data-range="1m">#}
{#                1 Month#}
{#            </button>#}
{#        </div>#}
{#    </div>#}
{##}
{#    <!-- Technical Analysis Section -->#}
{#    <div id="technical-chart" class="bg-gray-800 text-white p-6 rounded-xl shadow-lg mb-8" style="min-height: 600px;">#}
{#        <p class="text-center text-2xl text-gray-400">Loading chart...</p>#}
{#    </div>#}
{##}
{#    <div id="technical-metrics" class="bg-white p-8 rounded-xl shadow-lg mb-8">#}
{#        <h2 class="text-3xl font-bold text-gray-800 mb-6">Technical Analysis</h2>#}
{#        <div class="space-y-4 text-xl text-gray-700">#}
{#            <p>SMA 20: <span class="font-semibold text-gray-900" id="sma20">Loading...</span></p>#}
{#            <p>SMA 50: <span class="font-semibold text-gray-900" id="sma50">Loading...</span></p>#}
{#            <p>RSI: <span class="font-semibold text-gray-900" id="rsi">Loading...</span></p>#}
{#        </div>#}
{#    </div>#}
{##}
{#    <!-- Fundamental Analysis Section -->#}
{#    <div id="fundamental-metrics" class="bg-white p-8 rounded-xl shadow-lg">#}
{#        <h2 class="text-3xl font-bold text-gray-800 mb-6">Fundamental Analysis</h2>#}
{#        <div class="space-y-8">#}
{#            <!-- Sections like turnover trends, volume trends, and volatility can remain the same -->#}
{#        </div>#}
{#    </div>#}
{#</div>#}
{##}
{#<script>#}
{#    document.addEventListener('DOMContentLoaded', () => {#}
{#        const stockCode = document.getElementById('stock_code').textContent;#}
{##}
{#        // Function to fetch data for a selected time range#}
{#        const fetchChartData = (range) => {#}
{#            fetch(`/stocks/${stockCode}/technical-analysis/?range=${range}`)#}
{#                .then(response => response.json())#}
{#                .then(data => {#}
{#                    if (!data.plot) {#}
{#                        throw new Error("No plot data available.");#}
{#                    }#}
{##}
{#                    const plotData = JSON.parse(data.plot);#}
{#                    Plotly.newPlot('technical-chart', plotData.data, plotData.layout);#}
{##}
{#                    const metrics = data.analysis || {};#}
{#                    document.getElementById('technical-metrics').innerHTML = `#}
{#                        <h2 class="text-3xl font-bold text-gray-800 mb-6">Technical Analysis</h2>#}
{#                        <div class="space-y-4 text-xl text-gray-700">#}
{#                            <p>SMA 20: <span class="font-semibold text-gray-900">${metrics.trend?.sma20 || 'N/A'}</span></p>#}
{#                            <p>SMA 50: <span class="font-semibold text-gray-900">${metrics.trend?.sma50 || 'N/A'}</span></p>#}
{#                            <p>RSI: <span class="font-semibold text-gray-900">${metrics.momentum?.rsi || 'N/A'}</span></p>#}
{#                        </div>#}
{#                    `;#}
{#                })#}
{#                .catch(error => {#}
{#                    console.error("Error loading technical analysis:", error);#}
{#                    document.getElementById('technical-chart').innerHTML = `#}
{#                        <div class="alert alert-danger">#}
{#                            Error loading technical analysis: ${error.message}#}
{#                        </div>#}
{#                    `;#}
{#                });#}
{#        };#}
{##}
{#        // Add event listeners to time range buttons#}
{#        document.querySelectorAll('.time-range-btn').forEach(btn => {#}
{#            btn.addEventListener('click', (event) => {#}
{#                const range = event.target.dataset.range;#}
{#                fetchChartData(range);#}
{#            });#}
{#        });#}
{##}
{#        // Default to 1 day on page load#}
{#        fetchChartData('1d');#}
{#    });#}
{#</script>#}
{#{% endblock %}#}


{% extends 'base.html' %}
{% block content %}
    <div class="container mx-auto p-6">
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold mb-4">
                Stock Analysis for: <span id="stock_code" class="text-blue-600">{{ stock.code }}</span>
            </h1>
            <p class="text-gray-500">Explore key technical indicators and insights.</p>
        </div>

        <!-- Plots Section -->
        <div id="plots" class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
            <br>
            <div>Weekly MACD chart</div>
            <br>
            <div id="macdChart" class="plot-container rounded p-4"></div>
            <br>
            <div>Weekly OBV chart!</div>
            <br>
            <div id="obvChart" class="plot-container rounded p-4"></div>
            <br><br>
            <br><br>


        </div>

        <!-- Technical Analysis Table -->
        <div class="bg-white p-8 rounded-xl shadow-lg">
            <h2 class="text-3xl font-bold text-gray-800 mb-6">Technical Indicators</h2>
            <table class="w-full text-left border-collapse">
                <thead>
                <tr class="bg-gray-100">
                    <th class="px-4 py-2 border">Time Range</th>
                    <th class="px-4 py-2 border">RSI</th>
                    <th class="px-4 py-2 border">MACD</th>
                    <th class="px-4 py-2 border">EMA</th>
                    <th class="px-4 py-2 border">Bollinger Bands</th>
                    <th class="px-4 py-2 border">CCI</th>
                </tr>
                </thead>
                <tbody id="analysis-table-body">
                <tr>
                    <td colspan="6" class="text-center py-4 text-gray-500">Loading data...</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <style>
        .plot-container {
            width: 100%;
            height: 400px; /* Adjust height as needed */
        }
    </style>

    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const stockCode = document.getElementById('stock_code').textContent;

            const updateTable = (data) => {
                const tbody = document.getElementById('analysis-table-body');
                tbody.innerHTML = '';
                for (const [range, metrics] of Object.entries(data.analysis)) {
                    const row = `
                <tr>
                    <td class="px-4 py-2 border">${range.toUpperCase()}</td>
                    <td class="px-4 py-2 border">${metrics.rsi || 'N/A'}</td>
                    <td class="px-4 py-2 border">${metrics.MACD || 'N/A'}</td>
                    <td class="px-4 py-2 border">${metrics.EMA || 'N/A'}</td>
                    <td class="px-4 py-2 border">Upper: ${metrics.Bollinger_upper_band || 'N/A'}, Lower: ${metrics.Bollinger_lower_band || 'N/A'}</td>
                    <td class="px-4 py-2 border">${metrics.CCI || 'N/A'}</td>
                </tr>`;
                    tbody.insertAdjacentHTML('beforeend', row);
                }
            };

            const updatePlots = (data) => {
                // MACD Chart
                Plotly.newPlot('macdChart', [{
                    x: Object.keys(data.analysis),
                    y: data['analysis']['1w']['OBV'],
                    type: 'scatter',
                    mode: 'lines',
                    name: 'MACD',
                    line: {color: '#2196f3'}
                }], {title: 'MACD'});

                console.log(data['analysis']['1w']['OBV'])

                Plotly.newPlot('obvChart', [
                    {
                        x: ['Day 1'], // X-axis labels
                        y: data['analysis']['1d']['OBV'],
                        type: 'scatter',
                        mode: 'lines+markers',
                        name: '1 Day OBV'
                    },
                    {
                        x: ['Day 1', 'Day 2', 'Day 3', 'Day 4', 'Day 5', 'Day 6', 'Day 7'], // X-axis labels
                        y: data['analysis']['1w']['OBV'],
                        type: 'scatter',
                        mode: 'lines+markers', // Line chart with markers for each point
                        name: '1 Week OBV'
                    },
                    {
                        x: ['Day 8', 'Day 9', 'Day 10', 'Day 11', 'Day 12', 'Day 13', 'Day 14', 'Day 15', 'Day 16', 'Day 17', 'Day 18', 'Day 19', 'Day 20', 'Day 21', 'Day 22', 'Day 23', 'Day 24', 'Day 25', 'Day 26', 'Day 27', 'Day 28', 'Day 29', 'Day 30'], // X-axis labels for the 1 month data
                        y: data['analysis']['1m']['OBV'],
                        type: 'scatter',
                        mode: 'lines+markers', // Line chart with markers for each point
                        name: '1 Month OBV'
                    }
                ], {
                    title: 'On-Balance Volume (OBV)',
                    xaxis: {title: 'Time'},
                    yaxis: {title: 'OBV'},
                    width: 800,
                    height: 500
                });


            };

            const fetchAnalysis = (range) => {
                fetch(`/stocks/${stockCode}/technical-analysis/?range=${range}`)
                    .then(response => response.json())
                    .then(data => {
                        updateTable(data);
                        updatePlots(data);
                    })
                    .catch(error => console.error("Error fetching data:", error));
            };

            document.querySelectorAll('.time-range-btn').forEach(button => {
                button.addEventListener('click', () => {
                    const range = button.getAttribute('data-range');
                    fetchAnalysis(range);
                });
            });

            // Default Load
            fetchAnalysis('1d');
        });
    </script>
{% endblock %}
